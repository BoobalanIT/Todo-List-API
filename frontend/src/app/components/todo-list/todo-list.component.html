<div class="dashboard">
    <!-- Header -->
    <header class="dash-header">
        <div class="dash-header-left">
            <span class="logo-icon small">‚úì</span>
            <h1>My Todos</h1>
        </div>
        <button class="btn-ghost" (click)="logout()">
            <span>Logout</span>
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                <polyline points="16 17 21 12 16 7" />
                <line x1="21" y1="12" x2="9" y2="12" />
            </svg>
        </button>
    </header>

    <!-- Toolbar -->
    <div class="toolbar">
        <div class="search-box">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="11" cy="11" r="8" />
                <line x1="21" y1="21" x2="16.65" y2="16.65" />
            </svg>
            <input type="text" [(ngModel)]="searchQuery" (ngModelChange)="onSearch()" placeholder="Search todos..." />
        </div>

        <select [(ngModel)]="sortBy" (ngModelChange)="onSortChange()" class="sort-select">
            <option value="-createdAt">Newest First</option>
            <option value="createdAt">Oldest First</option>
            <option value="title">Title A-Z</option>
            <option value="-title">Title Z-A</option>
        </select>

        <button class="btn-primary btn-add" (click)="openCreateForm()">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19" />
                <line x1="5" y1="12" x2="19" y2="12" />
            </svg>
            <span>New Todo</span>
        </button>
    </div>

    <!-- Todo Grid -->
    @if (todos.length === 0) {
    <div class="empty-state">
        <div class="empty-icon">üìù</div>
        <h2>No todos yet</h2>
        <p>Create your first todo to get started!</p>
    </div>
    } @else {
    <div class="todo-grid">
        @for (todo of todos; track todo._id) {
        <div class="todo-card">
            <div class="todo-card-header">
                <h3>{{ todo.title }}</h3>
                <div class="todo-actions">
                    <button class="btn-icon" (click)="openEditForm(todo)" title="Edit">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
                        </svg>
                    </button>
                    <button class="btn-icon btn-danger" (click)="deleteTodo(todo)" title="Delete">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="3 6 5 6 21 6" />
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                        </svg>
                    </button>
                </div>
            </div>
            @if (todo.description) {
            <p class="todo-desc">{{ todo.description }}</p>
            }
            <span class="todo-date">{{ todo.createdAt | date: 'mediumDate' }}</span>
        </div>
        }
    </div>
    }

    <!-- Pagination -->
    @if (totalPages > 1) {
    <div class="pagination">
        <button class="btn-page" [disabled]="page <= 1" (click)="goToPage(page - 1)">‚Äπ Prev</button>
        @for (p of [].constructor(totalPages); track $index) {
        <button class="btn-page" [class.active]="page === $index + 1" (click)="goToPage($index + 1)">
            {{ $index + 1 }}
        </button>
        }
        <button class="btn-page" [disabled]="page >= totalPages" (click)="goToPage(page + 1)">Next ‚Ä∫</button>
    </div>
    }

    <!-- Modal Form -->
    @if (showForm) {
    <div class="modal-overlay" (click)="closeForm()">
        <div class="modal-card" (click)="$event.stopPropagation()">
            <h2>{{ editingTodo ? 'Edit Todo' : 'New Todo' }}</h2>
            <form (ngSubmit)="submitForm()">
                <div class="form-group">
                    <label for="todoTitle">Title</label>
                    <input type="text" id="todoTitle" [(ngModel)]="formTitle" name="formTitle"
                        placeholder="What needs to be done?" required />
                </div>
                <div class="form-group">
                    <label for="todoDesc">Description</label>
                    <textarea id="todoDesc" [(ngModel)]="formDescription" name="formDescription"
                        placeholder="Add details..." rows="3"></textarea>
                </div>

                @if (formError) {
                <div class="error-message">{{ formError }}</div>
                }

                <div class="modal-actions">
                    <button type="button" class="btn-ghost" (click)="closeForm()">Cancel</button>
                    <button type="submit" class="btn-primary" [disabled]="formLoading">
                        @if (formLoading) {
                        <span class="spinner"></span>
                        } @else {
                        {{ editingTodo ? 'Update' : 'Create' }}
                        }
                    </button>
                </div>
            </form>
        </div>
    </div>
    }

    <!-- Toast -->
    @if (toastVisible) {
    <div class="toast" [class.success]="toastType === 'success'" [class.error]="toastType === 'error'">
        {{ toastMessage }}
    </div>
    }
</div>